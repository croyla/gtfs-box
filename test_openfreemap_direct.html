<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>OpenFreeMap Direct Test</title>
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.5.2/dist/maplibre-gl.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #debug { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 10px; z-index: 1000; font-family: monospace; font-size: 12px; max-width: 400px; }
    </style>
</head>
<body>
<div id="debug">Loading OpenFreeMap...</div>
<div id="map"></div>
<script src="https://unpkg.com/maplibre-gl@4.5.2/dist/maplibre-gl.js"></script>
<script>
    const debug = document.getElementById('debug');
    function log(msg) {
        debug.innerHTML += '<br>' + msg;
        console.log(msg);
    }

    const map = new maplibregl.Map({
        container: 'map',
        style: {
            version: 8,
            sources: {
                openmaptiles: {
                    type: 'vector',
                    tiles: ['https://tiles.openfreemap.org/planet/{z}/{x}/{y}.pbf'],
                    minzoom: 0,
                    maxzoom: 14
                }
            },
            layers: [
                {
                    id: 'background',
                    type: 'background',
                    paint: { 'background-color': '#f0f0f0' }
                },
                {
                    id: 'water',
                    type: 'fill',
                    source: 'openmaptiles',
                    'source-layer': 'water',
                    paint: {
                        'fill-color': '#0000ff',  // Bright blue
                        'fill-opacity': 1
                    }
                },
                {
                    id: 'park',
                    type: 'fill',
                    source: 'openmaptiles',
                    'source-layer': 'park',
                    paint: {
                        'fill-color': '#00ff00',  // Bright green
                        'fill-opacity': 0.7
                    }
                },
                {
                    id: 'road',
                    type: 'line',
                    source: 'openmaptiles',
                    'source-layer': 'transportation',
                    paint: {
                        'line-color': '#ff0000',  // Bright red
                        'line-width': 2
                    }
                }
            ]
        },
        center: [77.5946, 12.9716], // Bengaluru
        zoom: 13
    });

    map.on('load', () => {
        log('✅ Map loaded');
        log('Zoom: ' + map.getZoom());
        log('Should see: gray bg, blue water, green parks, red roads');
    });

    map.on('error', (e) => {
        log('❌ ERROR: ' + e.error.message);
    });

    map.on('sourcedata', (e) => {
        if (e.isSourceLoaded && e.sourceId === 'openmaptiles') {
            log('✅ Tiles loaded');
        }
    });

    setTimeout(() => {
        const layers = map.getStyle().layers;
        log('---');
        log('Total layers: ' + layers.length);

        const canvas = map.getCanvas();
        log('Canvas: ' + canvas.width + 'x' + canvas.height);

        // Check if we can see any features
        const features = map.queryRenderedFeatures();
        log('Rendered features: ' + features.length);
        if (features.length > 0) {
            log('Sample: ' + features[0].layer.id + ' (' + features[0].sourceLayer + ')');
        } else {
            log('⚠️ NO FEATURES RENDERED!');
        }
    }, 3000);
</script>
</body>
</html>
