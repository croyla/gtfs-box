<!DOCTYPE html>
<html lang="ja_JP" style="overscroll-behavior: none;">
<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/fontawesome.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/brands.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/solid.css" />
	<link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.5.2/dist/maplibre-gl.css" />
	<link rel="stylesheet" href="mini-tokyo-3d.min.css" />
	<link rel="stylesheet" href="gtfs-box.css" />
	<link rel="stylesheet" href="debug.css" />
	<title>GTFS box - DEBUG MODE</title>
	<meta name="description" content="Debug version - A real-time 3D digital map of public transport systems with GTFS Realtime data." />
	<meta name="viewport" content="user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, width=device-width, height=device-height, initial-scale=1" />
	<meta property="og:title" content="GTFS box - DEBUG" />
	<meta property="og:description" content="Debug version - A real-time 3D digital map of public transport systems with GTFS Realtime data." />
	<!-- Load MapLibre GL JS v4.5.2 - Known stable version -->
	<script src="https://unpkg.com/maplibre-gl@4.5.2/dist/maplibre-gl.js"></script>
	<script>
		// Intercept Mapbox API calls to prevent 403 errors
		const originalFetch = window.fetch;
		window.fetch = function(url, options) {
			// Mock Mapbox tilequery API for timezone data
			if (typeof url === 'string' && url.includes('api.mapbox.com/v4/') && url.includes('/tilequery/')) {
				console.log('[MAPBOX INTERCEPT] Returning mock timezone data for:', url);
				return Promise.resolve(new Response(JSON.stringify({
					type: 'FeatureCollection',
					features: [{
						properties: {
							TZID: 'UTC'
						}
					}]
				}), {
					status: 200,
					headers: { 'Content-Type': 'application/json' }
				}));
			}
			return originalFetch.apply(this, arguments);
		};
	</script>
	<!-- Load MT3D MapLibre compatibility patch BEFORE mini-tokyo-3d.min.js -->
	<script src="mt3d-libre/mt3d-maplibre-patch.js"></script>
	<script src="mini-tokyo-3d.min.js?v=20251118-patch16"></script>
	<script src="mt3d-plugin-plateau.min.js"></script>
	<style>
		/* Debug mode indicator */
		body::before {
			content: "üêõ DEBUG MODE";
			position: fixed;
			top: 10px;
			left: 10px;
			background: #ff4444;
			color: white;
			padding: 8px 16px;
			border-radius: 4px;
			font-weight: bold;
			z-index: 10001;
			font-size: 14px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.3);
		}
	</style>
</head>
<body style="width: 100%; height: 100%; margin: 0; padding: 0; position: absolute; overscroll-behavior: none;">
	<div class="header">
		<div class="title">
			<div class="logo"><i class="fa-solid fa-bus"></i>GTFS box DEBUG</div>
			<div class="github"><i id= "github" class="fa-brands fa-github"></i></div>
			<div class="toggle"><i id= "toggle" class="fa-solid fa-angle-down"></i></div>
		</div>
		<div id="config-container" class="config-container">
			<div class="config">
				<div class="form">
					<div><select id="select"></select></div>
					<div><input id="gtfs-url" placeholder="GTFS zip file URL"></div>
					<div><input id="gtfs-vp-url"placeholder="GTFS Realtime VehiclePosition URL"></div>
					<div class="position">
						<div><input id="color" type="color" value="#000099"></div>
						<div><input id="zoom" placeholder="Zoom"></div>
						<div><input id="latitude" placeholder="Latitude"></div>
						<div><input id="longitude" placeholder="Longitude"></div>
						<div><input id="bearing" placeholder="Bearing"></div>
						<div><input id="pitch" placeholder="Pitch"></div>
						<div id="location"><i class="fa-solid fa-location-crosshairs"></i></div>
					</div>
				</div>
				<div class="submit">
					<div id="load"><i class="fa-solid fa-rotate-right"></i></div>
				</div>
			</div>
		</div>
	</div>
	<div id="map" class="content"></div>

	<!-- Debug panel scripts -->
	<script src="debug.js"></script>
	<script src="gtfs-box.js"></script>

	<!-- Auto-open debug panel in debug mode -->
	<script>
		// Auto-open debug panel after a short delay
		setTimeout(() => {
			if (window.debugPanel) {
				window.debugPanel.show();
				console.log('%cüêõ DEBUG MODE ACTIVE', 'background: #ff4444; color: white; padding: 10px; font-size: 16px; font-weight: bold;');
				console.log('Debug panel is automatically opened. Use the üêõ button to toggle it.');
			}
		}, 1000);
	</script>
</body>
</html>
